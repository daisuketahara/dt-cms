(function(d){var a=[];var u=[];var r=[];var y;var w;var v;var h;var o;var b;var m;var q;var p;var t;var g=0;var f=1;var x="";var z=0;var n;var c=0;var k;var s;d.fn.dtList=function(A){var C=d.extend({columns:"",labels:"",buttons:"",functions:true,sorting:true,filter:false,view:true,ajaxUrl:"",addUrl:"",editUrl:"",deleteUrl:"",limit:15,refresh:0},A);y=this;a=C.columns;u=C.labels;r=C.buttons;B=C.filter;n=C.view;c=C.refresh;b=C.sorting;p=C.functions;t=C.limit;w=C.ajaxUrl;v=C.addUrl;h=C.editUrl;o=C.deleteUrl;this.wrap('<form action="" class="im-list-form" method="post"></form>');if(u.length>0){var D='<div class="dt-cards-header card text-white mb-1">';D+='<div class="card-body p-2">';D+='<div class="row">';D+='<div class="col-1"></div>';for(i=0;i<u.length;i++){if(C.sorting){headerClass=" dt-cards-sort pointer"}else{headerClass=""}D+='<div class="col'+headerClass+' pt-1">';D+=u[i];if(C.sorting){D+='<a class="ml-3"><i class="fa fa-sort" aria-hidden="true"></i></a>'}D+="</div>"}D+='<div class="col-2 text-right">';if(C.addUrl!=""){D+='<a href="'+C.addUrl+'" class="table-add pointer float-right btn btn-success btn-sm"><i class="fa fa-plus"></i></a>'}D+="</div>";D+="</div>";D+="</div>";D+="</div>";this.append(D)}if(C.filter){var B='<tr class="im-table-filter">';if(C.functions){B+="<td></td>"}for(i=0;i<a.length;i++){B+='<td><input type="text" name="filter-'+a[i]+'" data-column="'+a[i]+'" placeholder="filter..."></td>'}if(C.functions){B+='<td class="text-right"></td>'}B+="</tr>";this.find("thead").append(B)}this.append('<div id="dt-cards-body"></div>');j();return this};function j(){clearInterval(k);var A=[];jQuery(".im-table-filter").find("input").each(function(){A.push(jQuery(this).data("column")+"="+jQuery(this).val())});d.ajax({url:w,type:"POST",data:{limit:t,offset:g,sortColumn:m,sortDirection:q,filter:A.join("&")},dataType:"json",success:function(C){C=JSON.parse(C);x=C.data;z=C.total;d("#dt-cards-body").empty();var B="";for(i=0;i<x.length;i++){B+='<div id="row-'+x[i]["id"]+'" class="card" data-id="'+x[i]["id"]+'">';B+='<div class="card-body p-2">';B+='<div class="row">';B+='<div class="col-1 pt-2"><input type="checkbox"> '+x[i]["id"]+".</div>";for(i2=0;i2<a.length;i2++){if(a[i2]["id2"]==undefined||a[i2]["id1"]==""){B+='<div class="col pt-2">'+e(x[i][a[i2]["id1"]])+"</div>"}else{B+='<div class="col"><span class="bold">'+e(x[i][a[i2]["id1"]])+"</span><br>";B+='<span class="italic font-sm">'+e(x[i][a[i2]["id2"]])+"</span></div>"}}B+='<div class="col-2 text-right pt-1">';for(i3=0;i3<r.length;i3++){B+="<a ";if(r[i3]["href"]!=undefined&&r[i3]["href"]!=""){B+='href="'+r[i3]["href"]+x[i]["id"]+'/" '}if(r[i3]["id"]!=undefined&&r[i3]["id"]!=""){B+='id="'+r[i3]["id"]+"/"+x[i]["id"]+'/" '}if(r[i3]["class"]!=undefined&&r[i3]["class"]!=""){B+='class="btn btn-sm text-white pointer ml-1 '+r[i3]["class"]+'" '}else{B+='class="btn btn-secondary btn-sm text-white pointer ml-1" '}B+=' data-id="'+x[i]["id"]+'">';B+=r[i3]["label"];B+="</a>"}if(n){B+='<a class="im-table-view btn btn-secondary btn-sm text-white pointer ml-1" data-id="'+x[i]["id"]+'"><i class="fa fa-search" aria-hidden="true"></i></a>'}if(h!=""){B+='<a href="'+h+x[i]["id"]+'" class="im-table-edit btn btn-secondary btn-sm text-white pointer ml-1"><i class="fa fa-pencil-alt" aria-hidden="true"></i></a>'}if(o!=""){B+='<a class="im-table-delete btn btn-secondary btn-sm text-white pointer ml-1" data-id="'+x[i]["id"]+'"><i class="fa fa-trash" aria-hidden="true"></i></a>'}B+="</div>";B+="</div>";B+="</div>";B+="</div>"}d("#dt-cards-body").html(B);if(t!=0){d("#dt-cards-body").append('<div class="text-center"><div class="dt-table-paginator"></div></div>');d(".dt-table-paginator").dtPaginator({page:f,lastPage:Math.ceil(z/t),showNext:true,showPrevious:true,showFirst:true,showLast:true,})}if(c>0){k=setInterval(function(){j()},(c*1000))}}})}function l(){var A=[];y.find("thead tr:first-child th").each(function(){A.push(d(this).data("column"))});return A}function e(B){if(B==null){return""}if(B===true){return'<a class="green"><i class="fas fa-check"></i></a>'}if(B===false){return'<a class="red"><i class="fas fa-times"></i></a>'}if(B.timestamp){return moment(B.timestamp*1000).format("YYYY-MM-DD HH:mm:ss");var C=new Date(B.timestamp*1000);var A=C.getFullYear()+"-";A+=C.getFullYear()+"-"}return B}d(document).on("click",".im-table-sort",function(){var A=jQuery(this).data("sort");y.find("thead tr:first-child .im-table-sort").each(function(){d(this).data("sort","");d(this).find("a").html('<i class="fa fa-sort" aria-hidden="true"></i>')});m=d(this).data("column");if(A=="desc"){jQuery(this).data("sort","asc");d(this).find("a").html('<i class="fa fa-sort-up" aria-hidden="true"></i>');q="asc"}else{jQuery(this).data("sort","desc");d(this).find("a").html('<i class="fa fa-sort-down" aria-hidden="true"></i>');q="desc"}j()});d(document).on("blur",".im-table-filter input",function(){j()});d(document).on("submit",".im-table-form",function(A){A.preventDefault();j()});d(document).on("click",".pagination .page-link",function(){f=jQuery(this).data("page");g=(f-1)*t;j()});d(document).on("click",".im-table-view",function(){var F=d(this).data("id");for(i=0;i<x.length;i++){if(x[i]["id"]==F){var E=x[i];break}}var C="";for(var A in E){var D=A;if(y.find('[data-column="'+A+'"]').length){D=d('[data-column="'+A+'"]').text()}C+='<label class="modal-label">'+D+"</label><br>"+e(E[A])+"<br><br>"}var B="";if(h!=""){B+='<a href="'+h+"/"+x[i]["id"]+'" class="im-table-edit btn btn-secondary btn-sm text-white pointer ml-1"><i class="fa fa-pencil-alt" aria-hidden="true"></i></a>'}if(o!=""){B+='<a class="im-table-delete btn btn-secondary btn-sm text-white pointer ml-1" data-id="'+x[i]["id"]+'"><i class="fa fa-trash" aria-hidden="true"></i></a>'}d("#dt-modal").dtModal({title:translations["View record"]+": "+E.id,content:C,buttons:B,size:"lg"})});d(document).on("click",".im-table-delete",function(){var C=d(this).data("id");var B="<p>"+translations["You are about to delete a record, this cannot be undone."]+"</p>";B+="<p>"+translations["Do you want to proceed?"]+"</p>";var A='<button type="button" class="btn btn-default" data-dismiss="modal">'+translations.Cancel+"</button>";A+='<button type="button" id="confirm-delete" class="btn btn-danger btn-ok" data-url="'+o+'" data-id="'+C+'" data-dismiss="modal">'+translations.Delete+"</button>";d("#dt-modal").dtModal({title:translations["Confirm delete"],content:B,buttons:A})});jQuery(document).on("click","#confirm-delete",function(B){var A=d(this).data("url");var C=d(this).data("id");d.ajax({url:A+"/"+C,type:"POST",dataType:"html",success:function(D){if(D==1){setTimeout(function(){y.find("#row-"+C).css({background:"#d23430"});y.find("#row-"+C+" td").each(function(){d(this).wrapInner('<div class="td_wrapper"></div>')});y.find("#row-"+C+" .td_wrapper").each(function(F,G){d(this).slideUp()});y.find("#row-"+C+" td").animate({"padding-top":"0px","padding-bottom":"0px"},function(){j()})},400)}else{var E='<p class="red">'+translations["An error has occurred."]+"</div>";E+='<p class="red">'+translations["Please try again."]+"</div>";d("#dt-modal").dtModal({title:translations.Error,content:E,})}}})})}(jQuery));
